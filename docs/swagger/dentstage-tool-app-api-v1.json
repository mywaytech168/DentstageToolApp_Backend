{
  "openapi": "3.0.1",
  "info": {
    "title": "Dentstage Tool App API",
    "version": "v1",
    "description": "提供凹痕工廠後台系統的標準化 API 介面，包含服務狀態檢查。",
    "contact": {
      "name": "Dentstage Tool App Team",
      "email": "support@dentstage.com"
    }
  },
  "paths": {
    "/api/HealthCheck": {
      "get": {
        "tags": [
          "HealthCheck"
        ],
        "summary": "取得系統健康狀態",
        "description": "回傳健康檢查資訊，確認服務是否正常運作。",
        "responses": {
          "200": {
            "description": "成功取得健康檢查資訊。",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthCheckResponse"
                },
                "examples": {
                  "default": {
                    "summary": "健康狀態範例",
                    "value": {
                      "status": "healthy",
                      "message": "後端服務啟動成功",
                      "timestamp": "2024-01-01T00:00:00Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/quotations/create": {
      "post": {
        "tags": [
          "Quotations"
        ],
        "summary": "新增估價單",
        "description": "建立估價單時的請求格式示例，photos 物件會依凹痕、美容、板烤、其他四大類別分別提交照片與估價設定。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "store": {
                    "type": "object",
                    "description": "門市來源與技師資訊。",
                    "properties": {
                      "estimationTechnicianUid": {
                        "type": "string",
                        "description": "估價技師的 UID，會同步寫入維修單欄位 EstimationTechnicianUID。"
                      },
                      "creatorTechnicianUid": {
                        "type": "string",
                        "description": "製單技師的 UID，若未指定則與估價技師相同，同步存入維修單 CreatorTechnicianUID。"
                      },
                      "source": {
                        "type": "string",
                        "description": "客戶來源描述。"
                      }
                    }
                  },
                  "car": {
                    "type": "object",
                    "description": "車輛相關識別資訊。",
                    "properties": {
                      "carUid": {
                        "type": "string",
                        "description": "車輛主檔 UID。"
                      }
                    }
                  },
                  "customer": {
                    "type": "object",
                    "description": "客戶主檔資訊。",
                    "properties": {
                      "customerUid": {
                        "type": "string",
                        "description": "客戶 UID。"
                      }
                    }
                  },
                  "photos": {
                    "type": "object",
                    "description": "依維修類型分組的照片集合，四大類別會自動對應凹痕、美容、板烤與其他。",
                    "properties": {
                      "dent": {
                        "type": "array",
                        "description": "凹痕類別的照片與估價項目。",
                        "items": {
                          "$ref": "#/components/schemas/QuotationPhotoItem"
                        }
                      },
                      "beauty": {
                        "type": "array",
                        "description": "美容類別的照片與估價項目。",
                        "items": {
                          "$ref": "#/components/schemas/QuotationPhotoItem"
                        }
                      },
                      "paint": {
                        "type": "array",
                        "description": "板烤類別的照片與估價項目。",
                        "items": {
                          "$ref": "#/components/schemas/QuotationPhotoItem"
                        }
                      },
                      "other": {
                        "type": "array",
                        "description": "其他類別的照片與估價項目。",
                        "items": {
                          "$ref": "#/components/schemas/QuotationPhotoItem"
                        }
                      }
                    }
                  },
                  "carBodyConfirmation": {
                    "type": "object",
                    "description": "車體確認資訊與簽名。",
                    "properties": {
                      "signaturePhotoUid": {
                        "type": "string",
                        "description": "簽名照片的 PhotoUID。"
                      }
                    }
                  },
                  "maintenance": {
                    "type": "object",
                    "description": "維修設定與折扣資訊。",
                    "properties": {
                      "estimatedRestorationPercentage": {
                        "type": "integer",
                        "description": "預估修復完成度百分比。"
                      }
                    }
                  }
                }
              },
              "example": {
                  "store": {
                    "estimationTechnicianUid": "U_054C053D-FBA6-D843-9BDA-8C68E5027895",
                    "creatorTechnicianUid": "U_054C053D-FBA6-D843-9BDA-8C68E5027895",
                  "source": "官方網站"
                },
                "car": {
                  "carUid": "Ca_00D20FB3-E0D1-440A-93C4-4F62AB511C2D"
                },
                "customer": {
                  "customerUid": "Cu_1B65002E-EEC5-42FA-BBBB-6F5E4708610A"
                },
                "photos": {
                  "dent": [
                    {
                      "photos": [
                        {
                          "photoUid": "Ph_759F19C7-5D62-4DB2-8021-2371C3136F7B",
                          "isPrimary": true
                        }
                      ],
                      "position": "保桿",
                      "dentStatus": "大面積",
                      "description": "需板金搭配烤漆",
                      "estimatedAmount": 4500
                    }
                  ],
                  "beauty": [],
                  "paint": [
                    {
                      "photos": [
                        {
                          "photoUid": "Ph_1F8AC157-5AC2-4E9C-9E0C-A5E8B4C8F3B0",
                          "isPrimary": true
                        }
                      ],
                      "position": "右後葉子板",
                      "dentStatus": "刮痕",
                      "description": "刮傷需補土烤漆",
                      "estimatedAmount": 3200
                    }
                  ],
                  "other": []
                },
                "carBodyConfirmation": {
                  "signaturePhotoUid": "Ph_D4FB9159-CD9E-473A-A3D9-0A8FDD0B76F8"
                },
                "maintenance": {
                  "estimatedRestorationPercentage": 90
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "建立成功，回傳估價單編號。"
          },
          "400": {
            "description": "請求參數有誤或缺少必要欄位。"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "HealthCheckResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "description": "系統整體狀態描述。"
          },
          "message": {
            "type": "string",
            "description": "健康檢查的補充說明或提示訊息。"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "產生健康檢查結果的時間 (UTC)。"
          }
        },
        "required": [
          "status",
          "message",
          "timestamp"
        ]
      },
      "QuotationPhotoItem": {
        "type": "object",
        "description": "估價單建立或編輯時提交的傷痕項目，內含照片與估價資訊。",
        "properties": {
          "photos": {
            "type": "array",
            "description": "此傷痕對應的照片列表。",
            "items": {
              "type": "object",
              "properties": {
                "photoUid": {
                  "type": "string",
                  "description": "照片的唯一識別碼。"
                },
                "description": {
                  "type": "string",
                  "description": "照片補充說明，例如拍攝角度。"
                },
                "isPrimary": {
                  "type": "boolean",
                  "description": "是否為主要展示照片。"
                }
              },
              "required": [
                "photoUid"
              ]
            },
            "minItems": 1
          },
          "position": {
            "type": "string",
            "description": "損傷位置或部位描述。"
          },
          "dentStatus": {
            "type": "string",
            "description": "損傷狀態描述，例如大面積或刮痕。"
          },
          "description": {
            "type": "string",
            "description": "估價備註。"
          },
          "estimatedAmount": {
            "type": "number",
            "description": "預估金額 (元)。"
          }
        },
        "required": [
          "photos"
        ]
      }
    }
  }
}
