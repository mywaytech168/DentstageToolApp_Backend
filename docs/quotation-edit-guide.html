<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>編輯估價單流程說明</title>
  <style>
    body {
      font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
      margin: 0;
      padding: 0 24px 48px;
      background-color: #f8fafc;
      color: #1f2937;
      line-height: 1.7;
    }
    header {
      padding: 32px 0 16px;
    }
    h1, h2, h3 {
      color: #0f172a;
    }
    section {
      margin-bottom: 32px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
      padding: 24px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: #fefefe;
    }
    th, td {
      border: 1px solid #e2e8f0;
      padding: 12px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: #f1f5f9;
    }
    code {
      font-family: "JetBrains Mono", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      background-color: #e2e8f0;
      padding: 2px 6px;
      border-radius: 4px;
    }
    ul {
      padding-left: 20px;
    }
    .tips {
      border-left: 4px solid #2563eb;
      background-color: #dbeafe;
      padding: 12px 16px;
      margin-top: 16px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <!-- 頁首：交代本頁與 Swagger 的對應關係，確保讀者明白資料來源 -->
  <header>
    <h1>編輯估價單流程與欄位對照說明</h1>
    <p>本頁對應 Swagger 中 <code>POST /api/quotations/edit</code> 範例，彙整編輯估價單時必備的欄位、流程與常見驗證注意事項，協助前後端同步作業邏輯。</p>
  </header>

  <!-- 流程概觀：逐步說明編輯動作 -->
  <section>
    <h2>流程概觀</h2>
    <ol>
      <li><strong>取得既有估價單資料：</strong>建議先呼叫 <code>POST /api/quotations/detail</code> 取得完整資料，避免覆蓋舊值。</li>
      <li><strong>確認唯一識別：</strong>後端以 <code>quotationNo</code> 作為唯一識別，請確保帶入正確編號。</li>
      <li><strong>整理欲更新欄位：</strong>依下方欄位對照表組裝 JSON，僅需傳入需變動的欄位即可。</li>
      <li><strong>送出 API 請求：</strong>以 <code>application/json</code> 內容呼叫 <code>POST /api/quotations/edit</code>，成功會回傳 204。</li>
      <li><strong>重新取得最新內容：</strong>更新後可再次查詢詳情，確認資料已同步。</li>
    </ol>
    <div class="tips">
      <strong>小提醒：</strong>若同時由多人編輯估價單，建議更新前再次確認最新資料，避免互相覆蓋。
    </div>
  </section>

  <!-- 請求欄位對照表：欄位名稱完全採用 Swagger 範例與 Schema -->
  <section>
    <h2>請求欄位對照表</h2>
    <p>下表列出 Swagger 對應的請求欄位與中文說明。欄位名稱必須與 Swagger 一致，方能通過後端驗證。</p>
    <table>
      <thead>
        <tr>
          <th>JSON 欄位</th>
          <th>Swagger 定義摘要</th>
          <th>填寫說明 / 資料來源</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>quotationNo</code></td>
          <td>估價單編號。</td>
          <td>必填欄位，可從列表或詳情取得後直接帶入。</td>
        </tr>
        <tr>
          <td><code>store.technicianUid</code></td>
          <td>估價技師 UID。</td>
          <td>選填欄位，若需變更估價技師可填入新的 UID。</td>
        </tr>
        <tr>
          <td><code>store.source</code></td>
          <td>客戶來源描述。</td>
          <td>選填欄位，用於調整估價單來源資訊。</td>
        </tr>
        <tr>
          <td><code>store.reservationDate</code></td>
          <td>Swagger 範例中的預約日期。</td>
          <td>選填欄位，使用 ISO 8601 字串更新預約時程。</td>
        </tr>
        <tr>
          <td><code>store.repairDate</code></td>
          <td>Swagger 範例中的預計維修日期。</td>
          <td>選填欄位，用於同步維修排程資訊。</td>
        </tr>
        <tr>
          <td><code>car.carUid</code></td>
          <td>車輛主檔 UID。</td>
          <td>選填欄位，僅在更換車輛時填入新的 UID。</td>
        </tr>
        <tr>
          <td><code>customer.customerUid</code></td>
          <td>客戶主檔 UID。</td>
          <td>選填欄位，若估價單需改由其他客戶承接時更新。</td>
        </tr>
        <tr>
          <td><code>damages[].photos</code></td>
          <td>主要傷痕照片的 PhotoUID。</td>
          <td>選填欄位，若調整傷痕項目需帶入最新的照片 UID。</td>
        </tr>
        <tr>
          <td><code>damages[].position</code></td>
          <td>傷痕位置描述。</td>
          <td>選填欄位，可同步更新傷痕位置。</td>
        </tr>
        <tr>
          <td><code>damages[].dentStatus</code></td>
          <td>凹痕狀態敘述。</td>
          <td>選填欄位，調整後請與現場狀況一致。</td>
        </tr>
        <tr>
          <td><code>damages[].description</code></td>
          <td>備註說明。</td>
          <td>選填欄位，可補充施工需求或注意事項。</td>
        </tr>
        <tr>
          <td><code>damages[].estimatedAmount</code></td>
          <td>預估金額。</td>
          <td>選填欄位，數值型別，更新時請帶入完整金額。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.signaturePhotoUid</code></td>
          <td>簽名照片的 PhotoUID。</td>
          <td>選填欄位，更換簽名照片時需提供新的 UID。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].x</code></td>
          <td>Swagger 範例中的車體標記 X 座標。</td>
          <td>選填欄位，更新車體標記位置時使用。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].y</code></td>
          <td>Swagger 範例中的車體標記 Y 座標。</td>
          <td>選填欄位，搭配 X 座標調整標記位置。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].hasDent</code></td>
          <td>是否存在凹痕。</td>
          <td>選填欄位，布林值；反映該位置是否有凹痕。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].hasScratch</code></td>
          <td>是否存在刮傷。</td>
          <td>選填欄位，布林值；反映該位置是否有刮傷。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].hasPaintPeel</code></td>
          <td>是否存在漆面脫落。</td>
          <td>選填欄位，布林值；反映該位置是否有漆面受損。</td>
        </tr>
        <tr>
          <td><code>carBodyConfirmation.damageMarkers[].remark</code></td>
          <td>車體標記備註。</td>
          <td>選填欄位，記錄該標記的補充說明。</td>
        </tr>
        <tr>
          <td><code>maintenance.fixTypeUid</code></td>
          <td>維修類型 UID。</td>
          <td>選填欄位，更新估價單所屬的維修類型。</td>
        </tr>
        <tr>
          <td><code>maintenance.reserveCar</code></td>
          <td>是否需留車。</td>
          <td>選填欄位，布林值。</td>
        </tr>
        <tr>
          <td><code>maintenance.applyCoating</code></td>
          <td>是否需要鍍膜。</td>
          <td>選填欄位，布林值。</td>
        </tr>
        <tr>
          <td><code>maintenance.applyWrapping</code></td>
          <td>是否需要包膜。</td>
          <td>選填欄位，布林值。</td>
        </tr>
        <tr>
          <td><code>maintenance.hasRepainted</code></td>
          <td>是否曾烤漆。</td>
          <td>選填欄位，布林值；反映車輛既有狀態。</td>
        </tr>
        <tr>
          <td><code>maintenance.needToolEvaluation</code></td>
          <td>是否需要工具評估。</td>
          <td>選填欄位，布林值。</td>
        </tr>
        <tr>
          <td><code>maintenance.otherFee</code></td>
          <td>其他估價費用。</td>
          <td>選填欄位，數值型別；請填入完整金額。</td>
        </tr>
        <tr>
          <td><code>maintenance.roundingDiscount</code></td>
          <td>零頭折扣金額。</td>
          <td>選填欄位，數值型別；更新折扣時使用。</td>
        </tr>
        <tr>
          <td><code>maintenance.percentageDiscount</code></td>
          <td>折扣百分比。</td>
          <td>選填欄位，數值型別；例如 <code>10</code> 代表 10%。</td>
        </tr>
        <tr>
          <td><code>maintenance.discountReason</code></td>
          <td>折扣原因。</td>
          <td>選填欄位，說明折扣依據。</td>
        </tr>
        <tr>
          <td><code>maintenance.estimatedRepairDays</code></td>
          <td>預估維修天數。</td>
          <td>選填欄位，數值型別；若工期有異動請同步調整。</td>
        </tr>
        <tr>
          <td><code>maintenance.estimatedRepairHours</code></td>
          <td>預估維修小時。</td>
          <td>選填欄位，數值型別；補足細部工時。</td>
        </tr>
        <tr>
          <td><code>maintenance.estimatedRestorationPercentage</code></td>
          <td>預估修復完成度。</td>
          <td>選填欄位，數值型別；建議使用整數百分比。</td>
        </tr>
        <tr>
          <td><code>maintenance.suggestedPaintReason</code></td>
          <td>建議鈑烤原因。</td>
          <td>選填欄位，提供改採鈑烤的理由。</td>
        </tr>
        <tr>
          <td><code>maintenance.unrepairableReason</code></td>
          <td>無法維修原因。</td>
          <td>選填欄位，若確認無法修復時填寫。</td>
        </tr>
        <tr>
          <td><code>maintenance.remark</code></td>
          <td>維修設定備註。</td>
          <td>選填欄位，可紀錄施工提醒。</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- 進階欄位：說明 Swagger 未列出的後端延伸欄位，方便開發人員使用 -->
  <section>
    <h2>進階欄位（後端支援）</h2>
    <p>後端 <code>UpdateQuotationRequest</code> 類別另外支援下列欄位，雖未在 Swagger 範例中出現，但若有進階需求可一併傳入：</p>
    <ul>
      <li><strong>categoryRemarks：</strong>以 <code>dent</code>、<code>paint</code>、<code>other</code> 為 Key 的字典，用於更新各分類備註。</li>
      <li><strong>remark：</strong>估價單整體備註字串，更新時會覆蓋既有內容。</li>
    </ul>
    <div class="tips">
      <strong>使用建議：</strong>若需導入進階欄位，請同步更新 Swagger 或補充聯合測試案例，確保協作順暢。</div>
  </section>

  <!-- 常見錯誤：列出常遇到的驗證問題 -->
  <section>
    <h2>常見錯誤與排除方式</h2>
    <ul>
      <li><strong>400 驗證錯誤：</strong>確認請求已提供 <code>quotationNo</code>，並檢查 JSON 結構是否符合 Swagger。</li>
      <li><strong>找不到估價單：</strong>若回應 404，請確認編號是否存在，必要時重新查詢列表。</li>
      <li><strong>資料被覆蓋：</strong>更新前先取得詳情，僅傳遞需要變動的欄位，避免覆寫既有內容。</li>
    </ul>
  </section>

  <!-- 結尾：標註聯絡窗口 -->
  <section>
    <h2>維護與聯絡</h2>
    <p>如需擴充欄位或調整流程，請聯繫後端開發團隊並提供需求單，以便評估影響範圍與排程。</p>
  </section>
</body>
</html>
